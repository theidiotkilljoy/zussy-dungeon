<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Finale — Birthday Room</title>
<style>
  :root{
    --text:#e8ecf1; --bg:#0a0b10;
    --msgBg:rgba(0,0,0,.55); --msgBorder:#3a435c;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background:
      radial-gradient(1200px 800px at 50% 0, #121622 0, #0a0b10 70%),
      repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 2px, transparent 2px 4px);
    color:var(--text);
    font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Arial;
    overflow:hidden;
  }

  /* Scale the scene to fit */
  .stage{display:grid;place-items:center;height:100dvh;padding:10px}
  #scale { transform-origin:top center }

  /* Fixed logical viewport */
  #scene{
    position:relative; width:960px; height:540px;
    border:1px solid #222a3b; border-radius:14px; overflow:hidden;
    background:#0f1320 center/cover no-repeat;
    background-image:url("assets/img/room.png");
  }
  /* vignette */
  #scene::after{
    content:""; position:absolute; inset:0; pointer-events:none;
    background:radial-gradient(120% 100% at 50% 0, rgba(0,0,0,.15), rgba(0,0,0,.45));
    mix-blend-mode:multiply; opacity:.45;
  }

  /* Message banner */
  #message{
    position:absolute; left:12px; right:12px; top:12px;
    padding:10px 14px;
    background:var(--msgBg);
    border:1px solid var(--msgBorder); border-radius:10px;
    font-weight:800; letter-spacing:.2px; text-align:center;
    backdrop-filter: blur(2px);
    user-select:none;
  }
  #message.clickable{ cursor:pointer }

  /* Row of sprites aligned to the “floor” */
/* Bigger sprites: +60% (120px → 192px) */
.sprite{
  height:192px;               /* was 120px */
  width:auto;
  image-rendering:pixelated;
  display:block;
  pointer-events:auto;
  filter: drop-shadow(0 3px 6px rgba(0,0,0,.45));
}

/* Lower the row a bit (closer to the bottom) */
.row{
  position:absolute; left:0; right:0; bottom:48px;  /* was 80px */
  display:flex; justify-content:center; align-items:flex-end; gap:26px;
  pointer-events:none;
}

  /* Flash to dark */
  #flash{
    position:absolute; inset:0; background:#000; opacity:0; pointer-events:none;
  }
  @keyframes blackout {
    0%{opacity:0}
    15%{opacity:1}
    85%{opacity:1}
    100%{opacity:0}
  }
  .flash { animation:blackout .55s ease forwards }

  .hidden{display:none}
</style>
</head>
<body>
<div class="stage">
  <div id="scale">
    <div id="scene" aria-label="Birthday celebration room">
      <div id="message">Happy Birthday Zachary! Make a wish and blow out your candle</div>

      <!-- Cast row (initial): jiji, minnie, zussy2, cakemaia, artie -->
      <div id="row" class="row">
        <img id="jiji"      class="sprite" src="assets/img/jiji.png"      alt="Jiji">
        <img id="minnie"    class="sprite" src="assets/img/minnie.png"    alt="Minnie">
        <img id="zussy"     class="sprite" src="assets/img/zussy2.png"    alt="Zachary">
        <img id="cakemaia"  class="sprite" src="assets/img/cakemaia.png"  alt="Maia with cake">
        <img id="artie"     class="sprite" src="assets/img/artie.png"     alt="Artie">
      </div>

      <!-- Flash overlay -->
      <div id="flash"></div>
    </div>
  </div>
</div>

<script>
(function(){
  // Responsive scale to fit viewport
  const W=960, H=540;
  const scaleBox = document.getElementById('scale');
  function fit(){
    const maxW = Math.min(window.innerWidth*0.96, 1200);
    const maxH = window.innerHeight*0.94;
    const s = Math.min(maxW/W, maxH/H);
    scaleBox.style.transform = `scale(${s})`;
  }
  addEventListener('resize', fit); fit();

  const scene   = document.getElementById('scene');
  const row     = document.getElementById('row');
  const msg     = document.getElementById('message');
  const flash   = document.getElementById('flash');
  const cake    = document.getElementById('cakemaia');

  // State machine
  const DIALOG = [
    "Oh, don't worry",
    "I'm not here for you *just* yet",
    "But live every day thoughtfully, because you never know when..."
  ];
  let step = 0;
  let phase = 'party'; // 'party' -> 'death' -> 'done'

  // Click on cake to flip to 'death' scene
  cake.addEventListener('click', () => {
    if (phase !== 'party') return;

    // Flash blackout
    flash.classList.add('flash');

    // Swap background after the blackout reaches full
    setTimeout(()=>{
      scene.style.backgroundImage = 'url("assets/img/darkroom.png")';

      // Swap cast: only zussy (left) and death (right)
      row.innerHTML = `
        <img id="zussy" class="sprite" src="assets/img/zussy2.png" alt="Zachary">
        <img id="death" class="sprite" src="assets/img/death.png"  alt="Death">
      `;

      // Start death dialogue
      phase = 'death';
      step = 0;

      msg.innerHTML = `Death: ${DIALOG[step]}`;
      msg.classList.add('clickable');

      // Allow clicking the message to advance dialogue
      const advance = () => {
        if (phase !== 'death') return;
        step++;
        if (step < DIALOG.length) {
          msg.innerHTML = `Death: ${DIALOG[step]}`;
        } else {
          phase = 'done';
          // next page
          window.location.href = 'theend.html';
        }
      };
      msg.addEventListener('click', advance, { once:false });

    }, 110); // just after the flash peaks

    // Remove flash class when animation ends so it can be retriggered if needed
    flash.addEventListener('animationend', () => {
      flash.classList.remove('flash');
    }, { once:true });
  }, { passive:true });
})();
</script>
</body>
</html>
